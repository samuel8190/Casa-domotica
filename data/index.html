<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Casa DomÃ³tica - Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #4fc3f7;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .card {
      background: #1e1e1e;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0px 4px 6px rgba(0,0,0,0.5);
      text-align: center;
    }
    .card h3 {
      margin: 0 0 10px 0;
      color: #90caf9;
    }
    .status {
      font-size: 1.2em;
      margin: 5px 0;
    }
    canvas {
      margin-top: 30px;
      background: #1e1e1e;
      border-radius: 12px;
      padding: 10px;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 0.9em;
      color: #888;
    }
  </style>
</head>
<body>
  <h1>ğŸ  Casa DomÃ³tica</h1>
  <div class="dashboard">
    <div class="card"><h3>ğŸŒ¡ï¸ Temperatura</h3><div class="status" id="temp">-- Â°C</div></div>
    <div class="card"><h3>ğŸ’§ Humedad</h3><div class="status" id="hum">-- %</div></div>
    <div class="card"><h3>ğŸ”¥ Gas</h3><div class="status" id="gas">-- ppm</div></div>
    <div class="card"><h3>ğŸŒ§ï¸ Agua</h3><div class="status" id="water">-- %</div></div>
    <div class="card"><h3>ğŸš¶ Movimiento</h3><div class="status" id="motion">--</div></div>
    <div class="card"><h3>ğŸ‘• Tendedero</h3><div class="status" id="tender">--</div></div>
  </div>

  <canvas id="sensorChart"></canvas>

  <footer>Hecho con â¤ï¸ usando ESP32 + PlatformIO</footer>

  <script>
    const baseUrl = window.location.origin;
    const ctx = document.getElementById("sensorChart").getContext("2d");
    const chart = new Chart(ctx, {
      type: "line",
      data: {
        labels: [],
        datasets: [
          { label: "Temperatura (Â°C)", data: [], borderColor: "#ff5252", fill: false },
          { label: "Humedad (%)", data: [], borderColor: "#29b6f6", fill: false },
          { label: "Gas (ppm)", data: [], borderColor: "#ffa726", fill: false },
          { label: "Agua (%)", data: [], borderColor: "#66bb6a", fill: false },
          { label: "Movimiento", data: [], borderColor: "#ab47bc", fill: false },
          { label: "Tendedero", data: [], borderColor: "#fdd835", fill: false }
        ]
      },
      options: {
        responsive: true,
        plugins: { legend: { labels: { color: "#e0e0e0" } } },
        scales: {
          x: { ticks: { color: "#e0e0e0" } },
          y: { ticks: { color: "#e0e0e0" } }
        }
      }
    });

    async function updateData() {
      try {
        const res = await fetch(baseUrl + "/data");
        const data = await res.json();

        document.getElementById("temp").innerText = data.temp + " Â°C";
        document.getElementById("hum").innerText = data.hum + " %";
        document.getElementById("gas").innerText = data.gas + " ppm";
        document.getElementById("water").innerText = data.water + " %";
        document.getElementById("motion").innerText = data.motion ? "Detectado âœ…" : "No";
        document.getElementById("tender").innerText = (data.tender === "Exterior") ? "Exterior â˜€ï¸" : "Cubierto â˜”";

        const time = data.timestamp || new Date().toLocaleTimeString();
        if (chart.data.labels.length > 20) {
          chart.data.labels.shift();
          chart.data.datasets.forEach(ds => ds.data.shift());
        }
        chart.data.labels.push(time);
        chart.data.datasets[0].data.push(data.temp);
        chart.data.datasets[1].data.push(data.hum);
        chart.data.datasets[2].data.push(data.gas);
        chart.data.datasets[3].data.push(data.water);
        chart.data.datasets[4].data.push(data.motion ? 1 : 0);
        chart.data.datasets[5].data.push((data.tender === "Exterior") ? 1 : 0);

        chart.update();
      } catch (e) {
        console.error("Error obteniendo datos:", e);
      }
    }

    setInterval(updateData, 2000);
    updateData();
  </script>
</body>
</html>